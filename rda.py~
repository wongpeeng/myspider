#coding=utf-8 
import urllib2
from bs4 import BeautifulSoup 
import urllib 
import cookielib 
import re 
import httplib 
import time 
  
  
loginUrl="http://crm.rdamicro.com/RDAWebApp/login.aspx"
headers={"User-Agent":"Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2062.120 Safari/537.36"} 
studentCookie = cookielib.CookieJar()  
pageOpener = urllib2.build_opener(urllib2.HTTPCookieProcessor(studentCookie)) 
loginPageRequest = urllib2.Request(loginUrl)  
loginPageHTML = pageOpener.open(loginPageRequest).read() """ 
s=requests.Session() 
s.headers.update(headers) 
r=s.get(loginUrl) 
""" print loginPageHTML 
soup=BeautifulSoup(loginPageHTML) 
  
__VIEWSTATE=soup.find(id="__VIEWSTATE")['value']
__VIEWSTATEGENERATOR=soup.find(id="__VIEWSTATEGENERATOR")['value']
__EVENTVALIDATION=soup.find(id="__EVENTVALIDATION")['value'] 

login_data={ 
   ' __EVENTTARGET':'', '__EVENTARGUMENT':'', '__VIEWSTATE':__VIEWSTATE, '__VIEWSTATEGENERATOR':__VIEWSTATEGENERATOR,'__EVENTVALIDATION':__EVENTVALIDATION, 'txtUserName':'pengwang01','txtUserPwd':'Wp123456', 'butLogin.x':'34', 'butLogin.y':'16'
   } 
loginHeader = {  
            
          'User-Agent':'sssssssssssssssssssssss'
          } 
loginData=urllib.urlencode(login_data) 
loginRequest = urllib2.Request(loginUrl , loginData , headers) 
loginResponse = pageOpener.open(loginRequest) 
 print loginResponse 
  
theurl='http://crm.rdamicro.com/RDAWebApp/index.aspx'
  
mainPageRequest = urllib2.Request(theurl) 
  
mainPageHTML = pageOpener.open(mainPageRequest).read()  
soup=BeautifulSoup(mainPageHTML) 
  
__VIEWSTATE=soup.find(id="__VIEWSTATE")['value'] #__EVENTVALIDATION=soup.find(id="__EVENTVALIDATION")['value'] print __VIEWSTATE #print __EVENTVALIDATION 
searchdata={ 
      '__VIEWSTATE':__VIEWSTATE, 
      '__EVENTVALIDATION':'', 
      'txtCopNO':'', 'txtCAR_NO_S':'', 'drpStatus':'', 'txtHiddenOrOnline':'none', 'txtAuto_id':'', 'drpType':'', 'drpBaseType':'', 'ddlIsStatus':0, 'txtICCard':'', 'txtBILL_NO':'', 'txtGDateTime1':'', 'txtGDateTime2':'', 'drpFromKA':'', 'drpToKA':'', 'btnSearch':'%E6%9F%A5+%E8%AF%A2%28F%29'
} 
  
data2=urllib.urlencode(searchdata)   
searchData=urllib.urlencode(searchdata) 
searcgRequest=urllib2.Request(theurl , searchData , headers) 
searchResponse=pageOpener.open(searcgRequest) 
 print loginResponse print searchResponse 
  
searchHtml=searchResponse.read() 


